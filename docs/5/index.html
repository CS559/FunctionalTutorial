<!DOCTYPE html>
<html>
    
<!-- CS559 Workbook Pages - page content &copy; 2021, Michael Gleicher -->
<!-- This page is part of a Workbook developed for the 
    CS559 Computer Graphics Class at the University of Wisconsin
    https://graphics.cs.wisc.edu/Courses/559-sp2021/ -->
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="../../css/workbook.css">
        <script src="../../js/resizeIFrames.js"></script>
    </head>
    <body>
        <div class="container container--outer"><div class="maincolumn">
<main class="main" role="main">
	<article class="post">
		<header class="post__header"><h1 class="post__title">Page 5: Another Closure Example</h1>
		</header>
        
        
        
		<div class="content post__content clearfix"><p>Here is a variant of the example from the last page. I am making two counters that count different things. First, read the code and see if you can understand what it does. Then try it and see if your understanding is correct. Some explanations follow. The files are <a href="../../for_students/F-05-01.html" class="for_students">F-05-01.html</a> and <a href="../../for_students/F-05-01.js" class="for_students">F-05-01.js</a>, but I&rsquo;ll put the code here so we can refer to it</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#75715e">// this function transforms a row of buttons
</span><span style="color:#75715e"></span><span style="color:#00a8c8">function</span> <span style="color:#75af00">makeCounters</span><span style="color:#111">(</span><span style="color:#75af00">listOfButtonNames</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#75715e">// keep track of the total presses
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">let</span> <span style="color:#75af00">totalCount</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>

    <span style="color:#75715e">// we define the makeCounter function here so it has access to the 
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// total Count
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// the function takes the id of the button
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">function</span> <span style="color:#75af00">makeCounter</span><span style="color:#111">(</span><span style="color:#75af00">buttonName</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#75715e">// these two variables with be inside the closure of the
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// handler function
</span><span style="color:#75715e"></span>        <span style="color:#00a8c8">const</span> <span style="color:#75af00">button</span> <span style="color:#f92672">=</span> <span style="color:#111">document</span><span style="color:#111">.</span><span style="color:#75af00">getElementById</span><span style="color:#111">(</span><span style="color:#75af00">buttonName</span><span style="color:#111">);</span>
        <span style="color:#00a8c8">let</span> <span style="color:#75af00">count</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span>

        <span style="color:#75715e">// now we can define the handler that uses those two variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// when the function is created, it will enclose those variables
</span><span style="color:#75715e"></span>        <span style="color:#75af00">button</span><span style="color:#111">.</span><span style="color:#75af00">onclick</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">function</span><span style="color:#111">()</span> <span style="color:#111">{</span>
            <span style="color:#75af00">count</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>         <span style="color:#75715e">// note that we have access to both count and total count
</span><span style="color:#75715e"></span>            <span style="color:#75af00">totalCount</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
            <span style="color:#75af00">button</span><span style="color:#111">.</span><span style="color:#75af00">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#d88200">`</span><span style="color:#d88200">${</span><span style="color:#75af00">count</span><span style="color:#d88200">}</span><span style="color:#d88200"> - </span><span style="color:#d88200">${</span><span style="color:#75af00">totalCount</span><span style="color:#d88200">}</span><span style="color:#d88200">`</span><span style="color:#111">;</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}</span>
    <span style="color:#75715e">// now we need to apply that function to the buttons, I&#39;ll do it
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// with a loop
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">let</span> <span style="color:#75af00">buttonName</span> <span style="color:#00a8c8">of</span> <span style="color:#75af00">listOfButtonNames</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#75af00">makeCounter</span><span style="color:#111">(</span><span style="color:#75af00">buttonName</span><span style="color:#111">);</span>
    <span style="color:#111">}</span>
<span style="color:#111">}</span>

<span style="color:#75715e">// we can apply this to both rows
</span><span style="color:#75715e"></span><span style="color:#75af00">makeCounters</span><span style="color:#111">([</span><span style="color:#d88200">&#34;button1&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;button2&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;button3&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;button4&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;button5&#34;</span><span style="color:#111">]);</span>
<span style="color:#75af00">makeCounters</span><span style="color:#111">([</span><span style="color:#d88200">&#34;buttonA&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;buttonB&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;buttonC&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;buttonD&#34;</span><span style="color:#111">,</span><span style="color:#d88200">&#34;buttonE&#34;</span><span style="color:#111">]);</span>
</code></pre></td></tr></table>
</div>
</div>
<p>And here it is running&hellip;</p>
<iframe
    title="F-05-01"
    src="../../for_students/F-05-01.html"
    class="includebox includebox-standard"
    width="100%"
    height="100%"
    scrolling="no"
    frameborder="0"
></iframe>

<p>Some things to observe&hellip;</p>
<ol>
<li>I define a function <code>makeCounters</code> that takes a list of buttons (line 2-28). It will change each one to a counter.</li>
<li>Within <code>makeCounters</code>, it defines a variable <code>totalCount</code> - this is one variable for the whole function. It will be shared by everything inside of the function.</li>
<li>Within <code>makeCounters</code> it defines a function <code>makeCounter</code> - you saw this on the last page. But notice, this version has access to both its own variables, but also the variables of its outer block.</li>
<li>Within <code>makeCounter</code> we define a function that is not named, but is assigned to the button&rsquo;s click handler. You saw this on the last page. The difference here: <em>this function has access to all of its enclosing scopes.</em> So it can access the variables both in <code>makeCounter</code> but also in <code>makeCounters</code>.</li>
<li>Line 20 uses a JavaScript <em>template literal</em> - it basically creates a string with both numbers in it. To learn about template literals check out <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals" target="_blank">Template Literals Documentation</a></li>
<li>Remember, the function in lines 17-21 only gets run when a button is pressed, and only updates the one button that is pressed. This is why when you click a button, only that button updates - but the variables inside get updated for the next button press.</li>
<li>Notice how each row is a separate invocation of <code>makeCounters</code> so it gets its own <code>totalCount</code> variable. Just like each button is a separate invocation of  <code>makeCounter</code> so it gets its own <code>counter</code>.</li>
</ol>
<p>In my mind, this is a useful use of a closure. Yes, I could have written this by creating objects for each button (that store counters) and for each row (to store the &ldquo;total count&rdquo;). But that would have required defining two classes of objects, &hellip; I find the closure to be concise. But it is a style thing. You rarely need to use a closure - there is always some other way to do it. Closures are just often an elegant solution.</p>
<p>That said, the use of closures for the <code>button</code> variable (line 20) is gratuitious. This inner function probably should have been written:
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">    <span style="color:#75af00">button</span><span style="color:#111">.</span><span style="color:#75af00">onclick</span> <span style="color:#f92672">=</span> <span style="color:#00a8c8">function</span><span style="color:#111">(</span><span style="color:#75af00">event</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#75af00">count</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
        <span style="color:#75af00">totalCount</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>
        <span style="color:#75af00">event</span><span style="color:#111">.</span><span style="color:#75af00">target</span><span style="color:#111">.</span><span style="color:#75af00">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#d88200">`</span><span style="color:#d88200">${</span><span style="color:#75af00">count</span><span style="color:#d88200">}</span><span style="color:#d88200"> - </span><span style="color:#d88200">${</span><span style="color:#75af00">totalCount</span><span style="color:#d88200">}</span><span style="color:#d88200">`</span><span style="color:#111">;</span>
    <span style="color:#111">}</span></code></pre></td></tr></table>
</div>
</div>
Because the use of <code>button</code> makes the assumption that button isn&rsquo;t going to change. But I used a closure because this workbook is about practicing closures.</p>
<h2 id="closures">Closures</h2>
<p>That probably really isn&rsquo;t enough examples. Most students need to see many examples. But hopefully, this will help you get started. The key is to practice. Try using them!</p>

            
			
		</div>
	</article>
</main>

                </div>
                <div class="sidebar">
<h2 class="Side_Title">Closures Workbook: A Tutorial on Functional Programming in Javascript</h2>
<p class="Side__Note">Pages:</p>
<ul class="Side__List">
    <li class="Side__Item Side__Unselected"><a href="../../">Index (Introduction)</a></li>
        <li class="Side__Item Side__Unselected"> <a href="../../docs/1/">1: A Simple Example </a></li>
        <li class="Side__Item Side__Unselected"> <a href="../../docs/2/">2: Variables and Scope </a></li>
        <li class="Side__Item Side__Unselected"> <a href="../../docs/3/">3: Closure </a></li>
        <li class="Side__Item Side__Unselected"> <a href="../../docs/4/">4: Closure Example </a></li>
        <li class="Side__Item Side__Selected"> 5: Another Closure Example </li>
</ul>
</div>
</div>
    </body>
</html>
